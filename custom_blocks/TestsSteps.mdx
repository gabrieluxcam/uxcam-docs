---
name: TestsSteps
---
import { Children, isValidElement, useState, useMemo, useEffect } from 'react'

export const EnhancedStep = ({ title, children }) => <>{children}</>

export const EnhancedStepper = ({ children, saveKey }) => {
  // turn children into an array
  const steps = useMemo(
    () => Children.toArray(children).filter(c => isValidElement(c)),
    [children]
  )

  const [current, setCurrent] = useState(() => {
    if (saveKey && typeof window !== 'undefined') {
      const s = parseInt(localStorage.getItem(saveKey), 10)
      return Number.isInteger(s) && s >= 0 && s < steps.length ? s : 0
    }
    return 0
  })

  useEffect(() => {
    if (saveKey) localStorage.setItem(saveKey, String(current))
  }, [current, saveKey])

  useEffect(() => {
    const onKey = e => {
      if (e.key === 'ArrowRight') setCurrent(c => Math.min(c + 1, steps.length - 1))
      if (e.key === 'ArrowLeft')  setCurrent(c => Math.max(c - 1, 0))
    }
    window.addEventListener('keydown', onKey)
    return () => window.removeEventListener('keydown', onKey)
  }, [steps.length])

  if (steps.length === 0) {
    return <div className="text-center text-gray-500">No steps provided.</div>
  }

  const pct = steps.length > 1
    ? Math.round((current / (steps.length - 1)) * 100)
    : 100

  return (
    <div className="max-w-2xl mx-auto p-6 border rounded-lg shadow-sm bg-white">
      {/* progress bar */}
      <div className="w-full h-2 bg-gray-200 rounded-full overflow-hidden mb-6">
        <div
          className="h-full bg-purple-600 transition-all"
          style={{ width: pct + '%' }}
          aria-hidden="true"
        />
      </div>

      {/* step indicators */}
      <div className="flex justify-between mb-8">
        {steps.map((step, idx) => {
          const isActive = idx === current
          return (
            <button
              key={idx}
              onClick={() => setCurrent(idx)}
              disabled={isActive}
              className="flex flex-col items-center focus:outline-none"
              aria-current={isActive ? 'step' : undefined}
              aria-label={`Go to step ${idx+1}: ${step.props.title || `Step ${idx+1}`}`}
            >
              <div
                className={`w-10 h-10 rounded-full flex items-center justify-center font-semibold border-2 transition-all ${
                  isActive
                    ? 'bg-purple-600 text-white scale-110 shadow-lg'
                    : 'bg-gray-300 text-gray-700'
                }`}
              >
                {idx + 1}
              </div>
              <span className={`mt-2 text-xs ${
                isActive ? 'text-purple-700' : 'text-gray-600'
              }`}>
                {step.props.title || `Step ${idx+1}`}
              </span>
            </button>
          )
        })}
      </div>

      {/* content */}
      <div className="prose prose-purple mb-8 p-4 bg-gray-50 rounded-lg">
        {steps[current].props.children}
      </div>

      {/* controls */}
      <div className="flex justify-between">
        <button
          onClick={() => setCurrent(c => Math.max(c-1,0))}
          disabled={current===0}
          className="px-6 py-2 bg-gray-200 rounded disabled:opacity-50"
        >Back</button>
        <button
          onClick={() => setCurrent(c => Math.min(c+1,steps.length-1))}
          disabled={current===steps.length-1}
          className="px-6 py-2 bg-purple-600 text-white rounded disabled:opacity-50"
        >Next</button>
      </div>
    </div>
  )
}

<EnhancedStepper saveKey="android-integration-tldr">
  <EnhancedStep title="Add SDK">
    Follow the **Android Quickstart** to include the UXCam AAR in your Gradle config.
  </EnhancedStep>

  <EnhancedStep title="Initialize">
    <p>In your <code>Application.onCreate()</code>:</p>
    <pre className="bg-gray-100 p-2 rounded"><code>UXCam.startWithKey("YOUR-APP-KEY");</code></pre>
  </EnhancedStep>

  <EnhancedStep title="Set Identity">
    <p>Tie in your user ID:</p>
    <pre className="bg-gray-100 p-2 rounded"><code>UXCam.setUserIdentity("user-id");</code></pre>
  </EnhancedStep>

  <EnhancedStep title="Verify">
    Confirm your first session appears in the UXCam dashboard.
  </EnhancedStep>
</EnhancedStepper>
